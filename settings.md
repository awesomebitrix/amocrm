# Настройка подключения к amoCRM
Настройка подключения к amoCrm производится в административной части сайта по адресу «Настройки» - «Настройки модулей» - «AmoCRM - интеграция с веб-формами и почтовыми событиями». 

![Настройки подключения](./settings/2-1.png)
Для настройки подключения на первой вкладке необходимо:

1. Ввести домен на проекте amoCRM;
2. Ввести email (логин);
3. Ввести ключ для авторизации в API (находится в настройках вашей amoCRM в разделе API. Обратите внимание, что после смены пароля, ключ сбрасывается и устанавливается новый).
4. Нажать на кнопку «Подключиться к amoCRM» либо «Сохранить»/«Применить».

Если введенные данные корректны, то статус в заголовке первой вкладки измениться с «нет подключения» на «есть подключение».
![Подключение успешно](./settings/2-2.png)
 
Если в процессе подключения возникли ошибки, то они будут отображены над вкладками.
![Ошибка подключения](./settings/2-3.png)

После успешного подключения к amoCRM, модуль предоставит возможность создавать правила интеграции для почтовых событий и веб-форм (в старших редакциях Битрикса). 
![Создание новых правил интеграции](./settings/3-1.png)

Настроить новое правило интеграции можно прямо в настройках подключения на отдельной вкладке, но рекомендуется делать это в новом, специально предназначенном для этого интерфейсе. Перейти в него можно, нажав на кнопку "Правила интеграции" над формной настроки подключения.
![Переход в новый интерфейс настройки правил интеграции](./settings/3-2.png)

В разделе "[Настройка правил интеграции](./rules.md)" рассмотрена настройка через новый интерфейс. Старый интерфейс со временем будет удалён.

Обратите внимание, что если по каким-то причинам подклюяение к amoCRM установить не удалось, то все уже существующие правила интеграции отображены не будут.

### Включение и выключение всех правил интеграции
Все правила интеграции можно отключить, не нарушая подключение к amoCRM, для этого надо снять галочку «Интеграция включена» под кнопкой «Подключиться к amoCRM».

## Правила интеграции
Каждое Правило интеграции позволяет настроить интеграцию одного почтового события или одной веб-формы с amoCRM. Решение позволяет создать по одному правилу для каждых веб-формы и почтового события.

### Раздел «Общие настройки»
![Общие настройки](./settings/settings_common.png)
1. интеграция включена - можно отключить правило интеграции, тогда данные в amoCrm отправлены не будут.
2. ответственный пользователь - выбор отвественного за создаваемые сделку и/или контакт;
3. теги - будут добавлены в поле "теги" к создаваемым сделке и/или контакту
4. формат - html - информация передается "как есть", text - информация будет очищена от тегов, переносы строк сохранены;
5. группировать примечания
6. Искать метки рекламных компаний в cookies
7. Добавлять в «Неразобранное»
8. Название сделки в «Неразобранном»

### Раздел «Сделка»
Позволяет настроить значения по умолчанию для пользовательских полей сделки.

### Раздел «Контакт»
Позволяет настроить соотношение между полями интегрируемого почтового события или веб-формы и создаваемого контакта в amoCRM.

### Раздел «Задача»
Позволяет настроить соотношение между полями интегрируемого почтового события или веб-формы и создаваемой задачи в amoCRM.

Раздел находится в процессе наполнения

[на главную](./README.MD)